# Malicious Software

資安的工具使用不妥當的時候有時候會對系統造成很大的傷害，要小心不要成為受害者。

### Logic Bombs
Logic bomb 是一種程式碼中包含了一些邏輯錯誤的程式，這些程式會在特定的條件下觸發，例如說在**某個特定的**日期或是**某個特定的**事件發生時。

Some programmer (usually written by inner programmers) may hide a piece of code that starts deleting files, should he ever leave the company (and the salary database).


#### 範例
```c
#include <stdio.h>
#include <time.h>

int main() {
    time_t t = time(NULL);
    struct tm tm = *localtime(&t);
    if (tm.tm_year == 2019 && tm.tm_mon == 3 && tm.tm_mday == 1) {
        printf("Hello World!\n");
    }
    return 0;
}
```
這個程式會在 2019 年 4 月 1 日印出 Hello World!，但是如果我們把日期改成 2019 年 4 月 2 日，就不會印出 Hello World! 了。

### Viruses and Worms
Virus 和 Worms 是一種會自我複製的程式，他們會在系統中複製自己，並且在複製的過程中傳播到其他的系統中。
#### Example of a virus:
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void infect(){
    system("cp virus.c /tmp/virus.c");
    system("gcc /tmp/virus.c -o /tmp/virus");
    system("/tmp/virus");
}

int main(int argc, char *argv[]){
    char buf[100];
    strcpy(buf, argv[1]);
    if (strcmp(buf, "infect") == 0){
        infect();
    } else{
        system(buf);
    }
    return 0;
}
```
這個程式會在執行的時候複製自己到 `/tmp/virus` 並且執行 `/tmp/virus`，這樣就會不斷的複製自己，直到系統的資源被耗盡。

### Trojan Horses
Trojan Horses 是一種看起來很有用的程式，但是實際上卻是有害的程式，例如說一個看起來很有用的程式，但是實際上會在背景上偷偷的執行一些惡意的程式。

#### 範例
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void runme(){
    system("echo 'Hello World!'");
}

int main(int argc, char *argv[]){
    char buf[100];
    strcpy(buf, argv[1]);
    return 0;
}
```
這個程式看起來很無害，但是實際上會在背景上執行 `runme()`，這樣就可以偷偷的執行一些惡意的程式。

### Key Logger (Keystroke Cops)
A **program** or **hardware device** that captures every key depression on the computer. -> Monitor a user's activites by recording every keystroke the user makes, including typos, backspacing, and retrying.

側錄任何使用者，可能掛上作業系統的核心中，只要觸發起來，所有 process 共用，核心部分就會拿到按鍵的使用，因此可以拿到所有使用者的資料。(kernel module)  

Python 有些 package 有 api 可以直接做互動

有些無線鍵盤的接受器就可能會有 Key Logger 可以模擬成一個鍵盤

> [!Note]
> Write the Key Logger side-project

#### 範例
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

FILE* keylogfile;

void keylogger(char *key){
    keylogfile = fopen("/tmp/keylog.txt", "a");
    fprintf(keylogfile, "%s", key);
    fclose(keylogfile);
}

int main(int argc, char *argv[]){
    char buf[100];
    strcpy(buf, argv[1]);
    return 0;
}
```
這個程式會在背景上記錄使用者輸入的東西，並且寫入 `/tmp/keylog.txt`，這樣就可以記錄使用者的帳號密碼，或是其他的敏感資訊。

### URL Injection
URL Injection 是一種會在網址中插入惡意的程式碼的程式，例如說會在網址中插入一些惡意的程式碼，這樣就可以偷偷的執行一些惡意的程式。

#### 範例
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

FILE* urlfile;

void urlinjection(char *url){
    urlfile = fopen("/tmp/url.txt", "a");
    fprintf(urlfile, "%s", url);
    fclose(urlfile);
}

int main(int argc, char *argv[]){
    char buf[100];
    strcpy(buf, argv[1]);
    return 0;
}
```
這個程式會在背景上記錄使用者輸入的網址，並且寫入 `/tmp/url.txt`，這樣就可以記錄使用者的瀏覽紀錄，或是其他的敏感資訊。


### Browser Hijaker
Browser Hijaker 是一種會修改瀏覽器的設定的程式，例如說會把瀏覽器的首頁改成某個網站，或是會在瀏覽器中插入廣告。

- Home page is changed
- Default Search engine is changed
- Cannot navigate to certain web pages like home pages of security software
- Getting re-directed to page you never intended to visit
- You see ads or ads pop up on your screen. But these ads are not served by the website
- You see new toolbars added
- You see new Bookmarks or Favorites added.
- Your web browser starts running sluggishly.

#### How to install
- be installed as part of freeware installation
- without user permission, as the result of an infected e-mail, a file share, or a drive-by download. 


#### 範例
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

FILE* browserconfigfile;
const int MAX_CONFIGS=5;//最大設定數量
char* configs[MAX_CONFIGS];//設定陣列
int num_configs=0;//目前設定數量

void add_config(char* config){
    if(num_configs<MAX_CONFIGS){
        configs[num_configs]=config;
        num_configs++;
    }
}

void browserhijaker(char *config){
    add_config(config);
    browserconfigfile = fopen("/tmp/browserconfig.txt", "w");
    for(int i=0;i<num_configs;i++){
        fprintf(browserconfigfile, "%s\n", configs[i]);
    }
    fclose(browserconfigfile);
}

int main(int argc, char *argv[]){
    char buf[100];
    strcpy(buf, argv[1]);
    return 0;
}
```
這個程式會在背景上修改瀏覽器的設定，並且寫入 `/tmp/browserconfig.txt`，這樣就可以修改瀏覽器的設定，例如說把瀏覽器的首頁改成某個網站，或是在瀏覽器中插入廣告。


### Add-on
額外安裝至瀏覽器上的應用程式，可以增加瀏覽器的功能，例如說可以增加瀏覽器的外觀介面，或是增加瀏覽器的功能。

add on = extension + theme + plug-in.
- extensions: 使用瀏覽器支援的程式語法，用來改變瀏覽器功能與操作的東西。
- themes: 使用瀏覽器支援的程式語法，用來改變瀏覽器外觀介面的東西。
- plug-ins: 指那些需編譯成執行檔，用以提供瀏覽器額外功能的東西。
- dictionaries
- language packs
- search engines.

Plug-ins also differ from extensions, which modify or add to existing functionality. 

![](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Plug-InExample_new.svg/488px-Plug-InExample_new.svg.png)


### Browser Toolbar



### Binder 
A tool that combines two or more files into a single file, usually for the purpose of hiding one of them. 


A binder compiles the list of files that you select into one host file, which you can rename. 

- A host file is a simple custom compiled program that will decompress and launch the embedded programs. 
- When you start the host, the embedded files in it are automatically decompressed and launched. 

When a piece of malware is bound with Notepad, for instance, the result will appear to be Notepad, and appear to run like Notepad, but the piece of malware will also be run.


The files embedded in a host file is not always a binary file. It can be a file of any type. Even an embedded file is a binary file, it may be a normal program.

檔案可以是任何形式，僅管是 binary file 也可以是一般的程式。

### Dropper

been designed to "install" some sort of malware (virus, backdoor, etc) to a target system. 

### Trojan Horse

social engineering techniques to trick users into running them.

找到合法的程式，偽裝隱藏在裡頭，合法以及不合法的程式都會被執行起來。

對象自己下載的程式，不是被傳染的，是自己下載的，因此不會被防毒軟體阻擋。



